#!/bin/bash
set -euo pipefail

#==============================================================#
# File      :   ipconfig
# Ctime     :   2021-04-29
# Mtime     :   2021-04-29
# Desc      :   generate single-meta config file based on template
# Path      :   bin/ipconfig <ip address>
# Copyright (C) 2018-2021 Ruohang Feng
#==============================================================#

PROG_NAME="$(basename $0))"
PROG_DIR="$(cd $(dirname $0) && pwd)"
PIGSTY_HOME="$(cd $(dirname ${PROG_DIR}) && pwd)"


#========================================#
# print available interface & ipv4 address
#========================================#
ip addr | egrep 'inet (([0-9]|[0-9]{2}|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[0-9]{2}|1[0-9]{2}|2[0-4][0-9]|25[0-5])'

#========================================#
# Arg1: meta node ip address (required)
#========================================#
META_NODE_IP=${1}
SED_COMMAND="s/10.10.10.10/${META_NODE_IP}/g"

echo "sed -e ${SED_COMMAND} ${PIGSTY_HOME}/files/pigsty.yml > ${PIGSTY_HOME}/pigsty.yml"
sed -e ${SED_COMMAND} ${PIGSTY_HOME}/files/pigsty.yml > ${PIGSTY_HOME}/pigsty.yml
