#!/usr/bin/env ansible-playbook
---
#==============================================================#
# File      :   infra-app.yml
# Ctime     :   2021-06-29
# Mtime     :   2021-06-29
# Desc      :   install application on pigsty
# Path      :   infra-app.yml
# Copyright (C) 2018-2021 Ruohang Feng (rh@vonng.com)
#==============================================================#

- name: Install Application
  become: no
  hosts: meta
  gather_facts: no
  tags: app
  vars:
    app: pgsql    # default application to be installed

  tasks:
    - name: Create app folder under home
      file: path=~/app state=directory

    - name: Sync application {{ app }} resources
      synchronize: src=app/{{ app }}/ dest=~/app/{{ app }}/

    - name: Check app {{ app }} install script
      stat: path=~/app/{{ app }}/install
      register: check_result

    - name: Install {{ app }} app
      when: not check_result.failed
      become: yes
      command: bash {{ check_result.stat.path }}

...
