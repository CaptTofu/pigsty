---
#--------------------------------------------------------------#
# Init PgBackrest Repo                         [pgbackrest_init]
#--------------------------------------------------------------#
- name: create pgbackrest repo stanza
  tags: [ pgbackrest, pgbackrest_init ]
  when: pgbackrest_method == 'local' or (pg_role == 'primary' and pg_upstream is not defined)
  become: yes
  become_user: "{{ pg_dbsu }}"
  shell: |
    /usr/bin/pgbackrest --stanza={{ pg_cluster }} start
    /usr/bin/pgbackrest --stanza={{ pg_cluster }} --no-online stanza-create


#--------------------------------------------------------------#
# Create Initial Backup                      [pgbackrest_backup]
#--------------------------------------------------------------#
- name: create pgbackrest initial backup
  tags: [ pgbackrest, pgbackrest_backup ]
  when: pg_role == 'primary' and pg_upstream is not defined
  ignore_errors: yes
  become: yes
  become_user: "{{ pg_dbsu }}"
  shell: |
    if [[ -f /etc/pgbackrest/initial.done ]]; then
        echo "initial backup already done"
    else
        /usr/bin/pgbackrest --stanza={{ pg_cluster }} backup
        date > /etc/pgbackrest/initial.done
    fi


...