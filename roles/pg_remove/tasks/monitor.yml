---
#------------------------------------------------------------------------------
# Remove PG Exporter
#------------------------------------------------------------------------------
- name: remove postgres exporter
  tags: pg_exporter
  become: yes
  ignore_errors: yes
  block:

    - name: deregister pg_exporter service from consul
      tags: consul_registry
      when: dcs_registry == 'consul'
      file:
        path: /etc/consul.d/svc-pg-exporter.json
        state: absent

    - name: reload consul to deregister pg_exporter
      when: dcs_registry == 'consul'
      systemd: name=consul state=reloaded

    - name: stop and disable pg_exporter service
      systemd: name=pg_exporter state=stopped enabled=no daemon_reload=yes

    - name: remove pg_exporter config file
      file: name=/etc/default/pg_exporter state=absent

#------------------------------------------------------------------------------
# Remove Pgbouncer Exporter
#------------------------------------------------------------------------------
- name: remove pgbouncer exporter
  tags: pgbouncer_exporter
  become: yes
  ignore_errors: yes
  block:

    - name: remove pgbouncer_exporter service from consul
      tags: consul_registry
      when: dcs_registry == 'consul'
      file:
        path: /etc/consul.d/svc-pgbouncer-exporter.json
        state: absent

    - name: reload consul to deregister pgbouncer_exporter
      when: dcs_registry == 'consul'
      systemd: name=consul state=reloaded

    - name: remove pgbouncer_exporter config file
      file: name=/etc/default/pgbouncer_exporter state=absent

...