---
#--------------------------------------------------------------#
# register service to haproxy                 [register_haproxy]
#--------------------------------------------------------------#
# pg_service, haproxy_reload
- import_tasks: haproxy.yml
  tags: register_haproxy

#--------------------------------------------------------------#
# register exporter targets to prometheus  [register_prometheus]
#--------------------------------------------------------------#
# pgsql_register
- import_tasks: prometheus.yml
  tags: register_prometheus

#--------------------------------------------------------------#
# register pgsql datasource to grafana        [register_grafana]
#--------------------------------------------------------------#
- import_tasks: grafana.yml
  tags: register_grafana

#--------------------------------------------------------------#
# TODO: DNS Register (apply for DNS name)         [register_dns]
#--------------------------------------------------------------#


#--------------------------------------------------------------#
# TODO: CMDB Register                            [register_cmdb]
#--------------------------------------------------------------#
# - import_tasks: cmdb.yml
#   tags: register_cmdb


#--------------------------------------------------------------#
# print summary                                     [pg_summary]
#--------------------------------------------------------------#
- name: print pgsql identity
  tags: pg_summary
  connection: local
  debug:
    msg: >-
      PGSQL INITED: [{{ pg_role }}] {{ pg_instance }} @ {{ inventory_hostname }}
        PGURL=postgres://{{ inventory_hostname }}:{{ pg_port }}/postgres
        {% if pg_databases is defined and pg_databases|length > 0%}Databases: {% for db in pg_databases %} {{ db.name }}{% endfor %}{% endif %}

...