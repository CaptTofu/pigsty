# Configuration Template

This directory (`files/conf`) contains pigsty configuration templates, Which will be used during `configure` procedure.

Config templates are named as `pigsty-<mode>.yml`.  `<mode>` can be designated using `./configure -m <mode>`

There are several built-in config modes:

### **demo (default for demo)** 

[pigsty-demo.yml](pigsty-demo.yml) : 4-node sandbox full demo configuration file

which have a one-node cluster `pg-meta` on `10.10.10.10`,
and a 3-node cluster `pg-test` on `10.10.10.11(node-1)` , `10.10.10.12(node-2)`, `10.10.10.13(node-3)`

If not configured, this is the default configuration file.
If `vagrant` is used as admin user, this configuration template will be used automatically



### **auto (default for production)**

[pigsty-auto.yml](pigsty-auto.yml) : default config template for production

If mode is not specified, or `vagrant` is not the admin user name, this will be used as the default config templates

This is a modified version of `pigsty-demo.yml`, which is generated by [conf_gen.py](conf_gen.py)

* remove verbose comments on `all.childrens`
* remove unnecessary application : `isd`, `covid`
* disable jupyter & pgweb by default
* `dcs_clean` and `pg_clean` set to `false` instead of `true`
* * uplift pg_dummy_filesize from 64MiB to 1GiB
* do not overwrite node's timezone
* do not overwrite node's hostname with database instance name
* do not update node's dns resolv config
* do not update node's ntp config
* do not exchange dbsu's ssh key

if meta node 's cpu core > 8, `node_tune` and `pg_conf` will be set to `oltp` mode.


### **misc**

Besides, there are some pre-defined configuration examples based on 4-node sandbox

* [pigsty.yml](pigsty.yml) : exact as repo default pigsty.yml
* [pigsty-demo.yml](pigsty-demo.yml) : enable all beta features for demonstration (redis, pgweb, jupyter, etc...)
* [pigsty-auto.yml](pigsty-auto.yml) : auto generated template for production installtion
* [pigsty-citus.yml](pigsty-citus.yml) : create citus cluster: 1 coordinator and 3 data nodes 
* [pigsty-dcs3.yml](pigsty-dcs3.yml) : 3 node x 3 meta pigsty deployment
* [pigsty-mxdb.yml](pigsty-mxdb.yml) : create matrixdb (greenplum 7) on 4 nodes sandbox 
* [pigsty-pub4.yml](pigsty-pub4.yml) : configuration file for [public demo](http://demo.pigsty.cc)  

## Templating

There are some placeholder values in configuration: Such as meta node ip address. which is hard-coded as `10.10.10.10`.

It will be REPLACED to actual ip address during `configure` with `sed`.

you could just run `configure` and follow the interactive wizard, or render it with `sed` manully:

```bash
sed_cmd="s/10.10.10.10/${primary_ip}/g"
config_src=${pigsty_home}/files/conf/pigsty-${mode}.yml
config_dst=${pigsty_home}/pigsty.yml
sed -e ${sed_cmd} ${config_src} > ${config_dst}
```


## Example Config

[`example/`](example/) contains some example of cluster definition.

It can also be loaded via `load_cls.py` when using cmdb dynamic inventory.


## Alternative Upstream Repo

Default Repos:

```yaml
- { name: base           , baseurl: 'http://mirror.centos.org/centos/7/os/$basearch/'                                                ,  description: 'CentOS-7 - Base'                               , gpgcheck: no }
- { name: updates        , baseurl: 'http://mirror.centos.org/centos/7/updates/$basearch/'                                           ,  description: 'CentOS-7 - Updates'                            , gpgcheck: no }
- { name: extras         , baseurl: 'http://mirror.centos.org/centos/7/extras/$basearch/'                                            ,  description: 'CentOS-7 - Extras'                             , gpgcheck: no }
- { name: epel           , baseurl: 'http://download.fedoraproject.org/pub/epel/7/$basearch'                                         ,  description: 'CentOS 7 - EPEL'                               , gpgcheck: no }
- { name: centos-sclo    , baseurl: 'http://mirror.centos.org/centos/7/sclo/$basearch/sclo/'                                         ,  description: 'CentOS-7 - SCLo'                               , gpgcheck: no }
- { name: centos-sclo-rh , baseurl: 'http://mirror.centos.org/centos/7/sclo/$basearch/rh/'                                           ,  description: 'CentOS-7 - SCLo rh'                            , gpgcheck: no }
- { name: pgdg-common    , baseurl: 'https://download.postgresql.org/pub/repos/yum/common/redhat/rhel-7-$basearch'                   ,  description: 'PostgreSQL Common RPMs for RHEL 7 - $basearch' , gpgcheck: no }
- { name: pgdg-extras    , baseurl: 'https://download.postgresql.org/pub/repos/yum/common/pgdg-rhel7-extras/redhat/rhel-7-$basearch' ,  description: 'PostgreSQL Extra RPMs for RHEL 7 $basearch'    , gpgcheck: no }
- { name: pgdg14         , baseurl: 'https://download.postgresql.org/pub/repos/yum/14/redhat/rhel-7-$basearch'                       ,  description: 'PostgreSQL 14 for RHEL/CentOS 7 - $basearch'   , gpgcheck: no }
- { name: pgdg15-rc      , baseurl: 'https://download.postgresql.org/pub/repos/yum/15/redhat/rhel-7-$basearch'                       ,  description: 'PostgreSQL 15 for RHEL/CentOS 7 - $basearch'   , gpgcheck: no }
- { name: grafana        , baseurl: 'https://packages.grafana.com/oss/rpm'                                                           ,  description: 'Grafana Official Yum Repo'                     , gpgcheck: no }
- { name: prometheus     , baseurl: 'https://packagecloud.io/prometheus-rpm/release/el/7/$basearch'                                  ,  description: 'Prometheus and exporters'                      , gpgcheck: no }
- { name: citus          , baseurl: 'https://repos.citusdata.com/community/el/7/$basearch'                                           ,  description: 'Citus Community 7 - $basearch'                 , gpgcheck: no }
- { name: timescaledb    , baseurl: 'https://packagecloud.io/timescale/timescaledb/el/7/$basearch'                                   ,  description: 'TimescaleDB for RHEL/CentOS 7 - $basearch'     , gpgcheck: no }
- { name: nginx          , baseurl: 'https://nginx.org/packages/centos/7/$basearch/'                                                 ,  description: 'Nginx Official Yum Repo'                       , gpgcheck: no , skip_if_unavailable: true  }
- { name: docker-ce      , baseurl: 'https://download.docker.com/linux/centos/7/$basearch/stable'                                    ,  description: 'Docker CE Stable - $basearch'                  , gpgcheck: no , skip_if_unavailable: true  }

```

China Mirrors:

```yaml
- { name: base           , baseurl: 'https://mirrors.tuna.tsinghua.edu.cn/centos/7/os/$basearch/'                              ,  description: 'CentOS-7 - Base'                               , gpgcheck: no }
- { name: updates        , baseurl: 'https://mirrors.tuna.tsinghua.edu.cn/centos/7/updates/$basearch/'                         ,  description: 'CentOS-7 - Updates'                            , gpgcheck: no }
- { name: extras         , baseurl: 'https://mirrors.tuna.tsinghua.edu.cn/centos/7/extras/$basearch/'                          ,  description: 'CentOS-7 - Extras'                             , gpgcheck: no }
- { name: epel           , baseurl: 'https://mirrors.tuna.tsinghua.edu.cn/epel/7/$basearch'                                    ,  description: 'CentOS 7 - epel'                               , gpgcheck: no }
- { name: centos-sclo    , baseurl: 'https://mirrors.aliyun.com/centos/7/sclo/$basearch/sclo/'                                 ,  description: 'CentOS-7 - SCLo'                               , gpgcheck: no }
- { name: centos-sclo-rh , baseurl: 'https://mirrors.aliyun.com/centos/7/sclo/$basearch/rh/'                                   ,  description: 'CentOS-7 - SCLo rh'                            , gpgcheck: no }
- { name: pgdg-common    , baseurl: 'https://mirrors.tuna.tsinghua.edu.cn/postgresql/repos/yum/common/redhat/rhel-7-$basearch' ,  description: 'PostgreSQL Common RPMs for RHEL 7 - $basearch' , gpgcheck: no }
- { name: pgdg-extras    , baseurl: 'https://mirrors.tuna.tsinghua.edu.cn/postgresql/repos/yum/common/pgdg-rhel7-extras/redhat/rhel-7-$basearch' ,  description: 'PostgreSQL Extra RPMs for RHEL 7 $basearch' , gpgcheck: no }
- { name: pgdg14         , baseurl: 'https://mirrors.tuna.tsinghua.edu.cn/postgresql/repos/yum/14/redhat/rhel-7-$basearch'     ,  description: 'PostgreSQL 14 for RHEL/CentOS 7 - $basearch'   , gpgcheck: no }
- { name: pgdg15-rc      , baseurl: 'https://mirrors.tuna.tsinghua.edu.cn/postgresql/repos/yum/15/redhat/rhel-7-$basearch'     ,  description: 'PostgreSQL 15 for RHEL/CentOS 7 - $basearch'   , gpgcheck: no }
- { name: citus          , baseurl: 'https://repos.citusdata.com/community/el/7/$basearch'                                     ,  description: 'Citus Community 7 - $basearch'                 , gpgcheck: no }
- { name: timescaledb    , baseurl: 'https://packagecloud.io/timescale/timescaledb/el/7/$basearch'                             ,  description: 'TimescaleDB for RHEL/CentOS 7 - $basearch'     , gpgcheck: no }
- { name: nginx          , baseurl: 'https://nginx.org/packages/centos/7/$basearch/'                                           ,  description: 'Nginx Official Yum Repo'                       , gpgcheck: no , skip_if_unavailable: true  }
- { name: grafana        , baseurl: 'https://mirrors.tuna.tsinghua.edu.cn/grafana/yum/rpm'                                     ,  description: 'Grafana Official Yum Repo'                     , gpgcheck: no }
- { name: prometheus     , baseurl: 'https://packagecloud.io/prometheus-rpm/release/el/7/$basearch'                            ,  description: 'Prometheus and exporters'                      , gpgcheck: no }
- { name: docker-ce      , baseurl: 'https://mirrors.aliyun.com/docker-ce/linux/centos/7/$basearch/stable'                     ,  description: 'Docker CE Stable - $basearch'                  , gpgcheck: no , skip_if_unavailable: true  }
```

Europe Mirrors:

```yaml
- { name: base           , baseurl: 'https://mirrors.xtom.de/centos/$releasever/os/$basearch/'                                       ,  description: 'CentOS-7 - Base'                               , gpgcheck: no }
- { name: updates        , baseurl: 'https://mirrors.xtom.de/centos/$releasever/updates/$basearch/'                                  ,  description: 'CentOS-7 - Updates'                            , gpgcheck: no }
- { name: extras         , baseurl: 'https://mirrors.xtom.de/centos/$releasever/extras/$basearch/'                                   ,  description: 'CentOS-7 - Extras'                             , gpgcheck: no }
- { name: epel           , baseurl: 'https://mirrors.xtom.de/epel/$releasever/$basearch'                                             ,  description: 'CentOS 7 - EPEL'                               , gpgcheck: no }
- { name: centos-sclo    , baseurl: 'https://mirrors.xtom.de/centos/$releasever/sclo/$basearch/sclo/'                                ,  description: 'CentOS-7 - SCLo'                               , gpgcheck: no }
- { name: centos-sclo-rh , baseurl: 'https://mirrors.xtom.de/centos/$releasever/sclo/$basearch/rh/'                                  ,  description: 'CentOS-7 - SCLo rh'                            , gpgcheck: no }
- { name: pgdg-common    , baseurl: 'https://mirrors.xtom.de/postgresql/repos/yum/common/redhat/rhel-$releasever-$basearch'          ,  description: 'PostgreSQL Common RPMs for RHEL 7 - $basearch' , gpgcheck: no }
- { name: pgdg-extras    , baseurl: 'https://mirrors.xtom.de/postgresql/repos/yum/common/pgdg-rhel$releasever-extras/redhat/rhel-$releasever-$basearch' ,  description: 'PostgreSQL Extra RPMs for RHEL 7 $basearch'    , gpgcheck: no }
- { name: pgdg14         , baseurl: 'https://mirrors.xtom.de/postgresql/repos/yum/14/redhat/rhel-$releasever-$basearch'              ,  description: 'PostgreSQL 14 for RHEL/CentOS 7 - $basearch'   , gpgcheck: no }
- { name: pgdg15-rc      , baseurl: 'https://mirrors.xtom.de/postgresql/repos/yum/15/redhat/rhel-$releasever-$basearch'              ,  description: 'PostgreSQL 15 for RHEL/CentOS 7 - $basearch'   , gpgcheck: no }
- { name: grafana        , baseurl: 'https://packages.grafana.com/oss/rpm'                                                           ,  description: 'Grafana Official Yum Repo'                     , gpgcheck: no }
- { name: prometheus     , baseurl: 'https://packagecloud.io/prometheus-rpm/release/el/7/$basearch'                                  ,  description: 'Prometheus and exporters'                      , gpgcheck: no }
- { name: citus          , baseurl: 'https://repos.citusdata.com/community/el/7/$basearch'                                           ,  description: 'Citus Community 7 - $basearch'                 , gpgcheck: no }
- { name: timescaledb    , baseurl: 'https://packagecloud.io/timescale/timescaledb/el/7/$basearch'                                   ,  description: 'TimescaleDB for RHEL/CentOS 7 - $basearch'     , gpgcheck: no }
- { name: nginx          , baseurl: 'https://nginx.org/packages/centos/7/$basearch/'                                                 ,  description: 'Nginx Official Yum Repo'                       , gpgcheck: no , skip_if_unavailable: true  }
- { name: docker-ce      , baseurl: 'https://mirrors.xtom.de/docker-ce/linux/centos/$releasever/$basearch/stable'                    ,  description: 'Docker CE Stable - $basearch'                  , gpgcheck: no , skip_if_unavailable: true  }
```