---
- name: Setup node_exporter
  tags: [node_exporter]
  block:
    - name: Copy node_exporter service unit
      copy:
        src: node_exporter.service
        dest: /usr/lib/systemd/system/node_exporter.service
        owner: root
        mode: 0644

    - name: Config node_exporter
      template:
        src: node_exporter.default
        dest: /etc/default/node_exporter
        owner: root
        mode: 0644

    - name: Launch node_exporter service
      systemd:
        name: node_exporter
        state: restarted
        enabled: yes
        daemon_reload: yes

    - name: Waits node_exporter online
      wait_for: host=localhost port={{ node_exporter_port }} state=started timeout=10



...
