#!/usr/bin/env ansible-playbook
---
#==============================================================#
# File      :   nodes-remove.yml
# Mtime     :   2022-02-22
# Mtime     :   2022-11-05
# Desc      :   remove nodes from pigsty
# Path      :   nodes-remove.yml
# Copyright (C) 2018-2022 Ruohang Feng (rh@vonng.com)
#==============================================================#


#==============================================================#
# Playbook : Remove node                                       #
#==============================================================#
#
#  Remove node cluster `pg-test`
#     node-remove.yml -l pg-test
#
#  Remove instance (10.10.10.13) among cluster `pg-test`
#     pgsql-remove.yml -l 10.10.10.13
#
#  Remove postgres data along with pg_packages
#     pgsql-remove.yml -e rm_pgdata=true -e rm_pgpkgs=true
#
#  Register cluster/instance to infrastructure
#     pgsql-remove.yml --tags=register  # prometheus, grafana, nginx
#     pgsql-remove.yml --tags=service   # haproxy, vip
#     pgsql-remove.yml --tags=monitor   # pg_exporter, pgbouncer_exporter, node_exporter, promtail
#     pgsql-remove.yml --tags=pgbouncer # pgbouncer
#     pgsql-remove.yml --tags=postgres  # postgres
#     pgsql-remove.yml --tags=haproxy   # remove haproxy
#==============================================================#
- name: REMOVE NODE
  become: yes
  hosts: all
  gather_facts: no
  ignore_errors: yes
  roles:

    - role: node_remove
      tags: node-remove

...